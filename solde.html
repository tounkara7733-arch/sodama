<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SODAMA - Soldes</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#ffffff; color:#0a3d62; }
.navbar { display:flex; justify-content:space-between; align-items:center; background:#0a3d62; padding:10px 20px; color:white; }
.navbar .logo { font-size:1.5rem; font-weight:bold; }
.navbar ul { display:flex; list-style:none; gap:15px; margin:0; padding:0; }
.navbar ul li a { text-decoration:none; color:white; padding:8px 15px; border-radius:5px; font-weight:bold; }
.navbar ul li a:hover { background:white; color:#0a3d62; }
.menu-toggle { display:none; flex-direction:column; cursor:pointer; }
.menu-toggle span { background:white; width:25px; height:3px; margin:4px 0; }
@media(max-width:768px){
  .menu-toggle{display:flex;}
  .navbar ul{position:absolute; top:60px; right:0; background:#0a3d62; width:200px; flex-direction:column; padding:10px; display:none;}
  .navbar ul.active{display:flex;}
}
h1 { text-align:center; margin:20px 0; }
.container { width:95%; max-width:600px; margin:20px auto; background:#f5f9ff; padding:20px; border-radius:10px; border:1px solid #0a3d62; }
.section { margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #d0d8f0; }
.section:last-child { border-bottom:none; }
.section h2 { margin:0 0 10px; font-size:1.1rem; }
.value { font-size:1.3rem; font-weight:bold; }
label { display:block; margin-top:5px; font-size:0.9rem; color:#555; }
.updated { text-align:center; font-size:0.8rem; color:#555; margin-top:5px; }
</style>
</head>
<body>

<nav class="navbar">
  <div class="logo">SODAMA</div>
  <div class="menu-toggle" id="mobile-menu"><span></span><span></span><span></span></div>
  <ul id="nav-links">
    <li><a href="index.html">Accueil</a></li>
    <li><a href="ciment.html">Ciment</a></li>
    <li><a href="transport.html">Transport</a></li>
    <li><a href="rapport.html">Rapport</a></li>
    <li><a href="versement.html">Versement</a></li>
    <li><a href="solde.html">Soldes</a></li>
  </ul>
</nav>

<h1>Soldes et Montants Globaux</h1>

<div class="container">
  <div class="section">
    <h2>Bénéfices</h2>
    <label>Bénéfice total Ciment</label>
    <div class="value" id="benefCiment">0 FCFA</div>
    <label>Bénéfice total Transport</label>
    <div class="value" id="benefTransport">0 FCFA</div>
    <label>Bénéfice total global</label>
    <div class="value" id="benefGlobal">0 FCFA</div>
  </div>

  <div class="section">
    <h2>Versements Banque</h2>
    <label>Total versements Ciment</label>
    <div class="value" id="versCiment">0 FCFA</div>
    <label>Total versements Transport</label>
    <div class="value" id="versTransport">0 FCFA</div>
    <label>Total versements globaux</label>
    <div class="value" id="versGlobal">0 FCFA</div>
  </div>

  <div class="section">
    <h2>Soldes Restants</h2>
    <label>Solde Ciment (bénéfices - versements)</label>
    <div class="value" id="soldeCiment">0 FCFA</div>
    <label>Solde Transport (bénéfices - versements)</label>
    <div class="value" id="soldeTransport">0 FCFA</div>
    <label>Solde global (tous bénéfices - tous versements)</label>
    <div class="value" id="soldeGlobal">0 FCFA</div>
  </div>

  <div class="updated" id="lastUpdated">Dernière mise à jour : --</div>
</div>

<script>
document.getElementById("mobile-menu").onclick = () => {
  document.getElementById("nav-links").classList.toggle("active");
};

// Mets la même URL Apps Script que sur tes autres pages
const GLOBAL_URL = "https://script.google.com/macros/s/AKfycbz6cngbQ44xOjvLyTd8-fBxCNgra12xgeF1Je6w-d0H6nKb-4DUhPIdyi4u11sfEEHCwg/exec";

function formatFCFA(val){ return Number(val).toLocaleString('fr-FR') + " FCFA"; }

// Charge ciment, transport, versements et calcule les totaux
async function loadSoldes(){
  try{
    const [cimentRes, transportRes, versRes] = await Promise.all([
      fetch(GLOBAL_URL + "?type=ciment"),
      fetch(GLOBAL_URL + "?type=transport"),
      fetch(GLOBAL_URL + "?type=versement")
    ]);

    const cimentRows = await cimentRes.json();
    const transportRows = await transportRes.json();
    const versementRows = await versRes.json();

    // Bénéfices totaux
    let benefCiment = 0;
    let benefTransport = 0;

    cimentRows.forEach(r => {
      const b = parseFloat(r.values[5]) || 0;
      benefCiment += b;
    });

    transportRows.forEach(r => {
      const b = parseFloat(r.values[5]) || 0;
      benefTransport += b;
    });

    const benefGlobal = benefCiment + benefTransport;

    // Versements totaux
    let versCiment = 0;
    let versTransport = 0;

    versementRows.forEach(r => {
      const type = (r.values[1] || "").toString().toLowerCase();
      const montant = parseFloat(r.values[2]) || 0;
      if(type === "ciment") versCiment += montant;
      if(type === "transport") versTransport += montant;
    });

    const versGlobal = versCiment + versTransport;

    // Soldes (bénéfices - versements)
    const soldeCiment = benefCiment - versCiment;
    const soldeTransport = benefTransport - versTransport;
    const soldeGlobal = benefGlobal - versGlobal;

    // Injection dans la page
    document.getElementById("benefCiment").textContent = formatFCFA(benefCiment);
    document.getElementById("benefTransport").textContent = formatFCFA(benefTransport);
    document.getElementById("benefGlobal").textContent = formatFCFA(benefGlobal);

    document.getElementById("versCiment").textContent = formatFCFA(versCiment);
    document.getElementById("versTransport").textContent = formatFCFA(versTransport);
    document.getElementById("versGlobal").textContent = formatFCFA(versGlobal);

    document.getElementById("soldeCiment").textContent = formatFCFA(soldeCiment);
    document.getElementById("soldeTransport").textContent = formatFCFA(soldeTransport);
    document.getElementById("soldeGlobal").textContent = formatFCFA(soldeGlobal);

    const now = new Date();
    document.getElementById("lastUpdated").textContent =
      "Dernière mise à jour : " +
      now.toLocaleDateString("fr-FR") + " " +
      now.toLocaleTimeString("fr-FR");

  }catch(e){
    console.error("Erreur chargement soldes:", e);
    alert("Erreur chargement des soldes");
  }
}

// Lancement initial
loadSoldes();

// Si tu veux que ça se rafraîchisse automatiquement toutes les 30 secondes, décommente la ligne suivante :
// setInterval(loadSoldes, 30000);
</script>

</body>
</html>
